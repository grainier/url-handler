#!/bin/bash
set -e

APP_NAME="rdp_url_handler"
APP_EXECUTABLE="/usr/local/bin/$APP_NAME"
DESKTOP_ENTRY_NAME="rdp-url-handler.desktop"
DESKTOP_ENTRY_PATH="/usr/share/applications/$DESKTOP_ENTRY_NAME"

# Create the .desktop file in the system-wide applications directory
cat > "$DESKTOP_ENTRY_PATH" <<EOL
[Desktop Entry]
Name=RDP URL Handler
Exec=$APP_EXECUTABLE %u
Type=Application
MimeType=x-scheme-handler/rdp;
NoDisplay=true
EOL

# Set permissions for the .desktop file
chmod 644 "$DESKTOP_ENTRY_PATH"

# Update the MIME database
update-desktop-database

# Register the handler with the desktop environment
xdg-mime default "$DESKTOP_ENTRY_NAME" x-scheme-handler/rdp

echo "Registration complete. The 'rdp://' URL scheme is now handled by $APP_NAME."

exit 0
